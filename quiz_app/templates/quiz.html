{% extends 'base.html' %}

{% block title %}{{ level.name }} - Quiz{% endblock %}

{% block extra_css %}
    <style>
    .quiz-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .quiz-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #f0f0f0;
    }

    .quiz-header h1 {
        color: #333;
        font-size: 2.5rem;
        margin-bottom: 15px;
    }

    .progress-bar-container {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 20px;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        transition: width 0.5s ease;
        width: 0%;
    }

    .question-counter {
        color: #666;
        font-size: 1rem;
        margin-top: 10px;
    }

    .question-group {
        animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .question-text {
        font-size: 2rem;
        color: #333;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .question-word {
        color: #667eea;
        font-size: 2.5rem;
        display: inline-block;
        margin: 0 10px;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
    }

    .options-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
        margin-top: 30px;
    }

    .option-btn {
        padding: 20px 30px;
        font-size: 1.2rem;
        border: 3px solid #e0e0e0;
        background: white;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        text-align: left;
        position: relative;
        overflow: hidden;
    }

    .option-btn::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 0;
        background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        transition: width 0.3s ease;
    }

    .option-btn:hover:not(:disabled) {
        border-color: #667eea;
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .option-btn:hover:not(:disabled)::before {
        width: 100%;
    }

    .option-btn:disabled {
        cursor: not-allowed;
    }

    .option-btn.correct {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        color: white;
        border-color: #2ecc71;
        animation: correctPulse 0.5s ease;
    }

    .option-btn.selected {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }

    .option-btn.wrong {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border-color: #e74c3c;
    }

    .option-btn.correct {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        color: white;
        border-color: #2ecc71;
    }

    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        gap: 15px;
    }

    .btn-next, .btn-finish {
        flex: 1;
        padding: 15px 30px;
        font-size: 1.1rem;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .btn-next {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-next:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-next:disabled {
        background: #ccc;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .btn-finish {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        color: white;
    }

    .btn-finish:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(46, 204, 113, 0.4);
    }

    .review-container {
        margin-top: 30px;
    }

    .review-item {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 5px solid #667eea;
    }

    .review-item.correct-answer {
        border-left-color: #2ecc71;
    }

    .review-item.wrong-answer {
        border-left-color: #e74c3c;
    }

    .review-question {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
    }

    .review-word {
        color: #667eea;
        font-weight: 700;
    }

    .review-answers {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 10px;
    }

    .review-answer {
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 1rem;
    }

    .review-answer.user-answer {
        background: #fff3cd;
        border: 2px solid #ffc107;
    }

    .review-answer.correct-answer {
        background: #d4edda;
        border: 2px solid #2ecc71;
        font-weight: 600;
    }

    .review-answer.wrong-answer {
        background: #f8d7da;
        border: 2px solid #e74c3c;
    }

    .result-container {
        text-align: center;
        padding: 40px;
        animation: fadeInScale 0.5s ease-out;
    }

    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .result-icon {
        font-size: 5rem;
        margin-bottom: 20px;
    }

    .result-title {
        font-size: 2.5rem;
        color: #333;
        margin-bottom: 20px;
    }

    .score-display {
        font-size: 4rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 20px 0;
    }

    .score-percentage {
        font-size: 1.5rem;
        color: #666;
        margin-bottom: 30px;
    }

    .result-message {
        font-size: 1.3rem;
        color: #666;
        margin-bottom: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .hidden {
        display: none;
    }

    @media (max-width: 768px) {
        .question-text {
            font-size: 1.5rem;
        }

        .question-word {
            font-size: 2rem;
        }

        .option-btn {
            padding: 15px 20px;
            font-size: 1rem;
        }

        .score-display {
            font-size: 3rem;
        }
    }
    </style>
{% endblock %}

{% block content %}
<div class="quiz-container">
    <div class="card">
        <div class="quiz-header">
        <h1>{{ level.name }}</h1>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="question-counter" id="question-counter">–í–æ–ø—Ä–æ—Å 1 –∏–∑ {{ quiz_data|length }}</div>
        </div>

        <div id="quiz-box">
            {% for item in quiz_data %}
            <div class="question-group" id="question-group-{{ forloop.counter0 }}" style="{% if not forloop.first %}display:none{% endif %}" data-correct="{{ item.a|escapejs }}" data-question="{{ item.q|escapejs }}" data-question-index="{{ forloop.counter0 }}">
                <div class="question-text">
                    –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ: <span class="question-word">{{ item.q }}</span>
                </div>
                <div class="options-container">
                {% for o in item.opts %}
                    <button class="option-btn" data-option-value="{{ o|escapejs }}" onclick="selectAnswer(this)">
                        {{ o }}
                    </button>
                {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div id="result" class="hidden">
            <div class="result-container">
                <div class="result-icon" id="result-icon">üéâ</div>
                <h2 class="result-title">–ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
                <div class="score-display" id="score-text">0 / {{ quiz_data|length }}</div>
                <div class="score-percentage" id="score-percentage"></div>
                <div class="result-message" id="result-message"></div>
                
                <div class="review-container" id="review-container"></div>
                
                <div class="action-buttons">
                    <a href="{% url 'index' %}" class="btn btn-primary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    <button class="btn btn-secondary" onclick="location.reload()">üîÑ –ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞</button>
                </div>
            </div>
        </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
    let currentQuestion = 0;
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–∞
    const totalQuestions = parseInt('{{ quiz_data|length }}') || 0;
    let userAnswers = {}; // –•—Ä–∞–Ω–∏—Ç –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {questionIndex: selectedAnswer}
    
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    console.log('=== QUIZ INITIALIZATION ===');
    console.log('Total questions (from template):', totalQuestions);
    console.log('Quiz data length (raw):', '{{ quiz_data|length }}');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if (totalQuestions === 0) {
        console.error('ERROR: No questions found!');
        alert('–û—à–∏–±–∫–∞: –í–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –≥—Ä—É–ø–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
    document.addEventListener('DOMContentLoaded', function() {
        const allGroups = document.querySelectorAll('.question-group');
        console.log('Found question groups:', allGroups.length);
        allGroups.forEach((group, idx) => {
            const display = window.getComputedStyle(group).display;
            const questionIndex = group.dataset.questionIndex || group.getAttribute('data-question-index');
            console.log(`  Group ${idx}: id="${group.id}" display="${display}" data-index="${questionIndex}"`);
        });
        
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
        const firstGroup = document.getElementById('question-group-0');
        if (firstGroup) {
            const firstOptions = firstGroup.querySelectorAll('.option-btn');
            firstOptions.forEach(opt => opt.disabled = false);
            console.log('‚úì First question buttons unlocked');
        } else {
            console.error('‚úó First question group not found!');
        }
        
        console.log('=== INITIALIZATION COMPLETE ===');
    });

    function updateProgress() {
        const progress = ((currentQuestion + 1) / totalQuestions) * 100;
        document.getElementById('progress-bar').style.width = progress + '%';
        document.getElementById('question-counter').textContent = 
            `–í–æ–ø—Ä–æ—Å ${currentQuestion + 1} –∏–∑ ${totalQuestions}`;
    }

    function selectAnswer(btn) {
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–µ–∫—Å –≤–æ–ø—Ä–æ—Å–∞ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞ –≥—Ä—É–ø–ø—ã
        const questionGroup = btn.closest('.question-group');
        if (!questionGroup) {
            console.error('Question group not found!');
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–µ–∫—Å –≤–æ–ø—Ä–æ—Å–∞ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º dataset –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
        const questionIndex = parseInt(questionGroup.dataset.questionIndex || questionGroup.getAttribute('data-question-index'));
        
        if (isNaN(questionIndex)) {
            console.error('Invalid question index!', questionGroup.getAttribute('data-question-index'));
            console.error('Question group ID:', questionGroup.id);
            return;
        }
        
        console.log('=== selectAnswer called ===');
        console.log('questionIndex from data-attribute:', questionIndex);
        console.log('Question group ID:', questionGroup.id);
        
        const options = questionGroup.querySelectorAll('.option-btn');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ —É–∂–µ –∫–Ω–æ–ø–∫–∏
        if (options.length > 0 && options[0].disabled) {
            console.log('Buttons already disabled, ignoring click');
            return;
        }
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ
        options.forEach(opt => {
            opt.disabled = true;
        });

        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫
        options.forEach(opt => {
            opt.classList.remove('selected');
        });

        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
        btn.classList.add('selected');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º innerText –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
        const selectedAnswer = btn.innerText.trim();
        userAnswers[questionIndex] = selectedAnswer;
        
        console.log('Answer selected for question', questionIndex, ':', selectedAnswer);
        console.log('Total questions:', totalQuestions, 'Current index:', questionIndex);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(() => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å
            // questionIndex –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0, –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å = totalQuestions - 1
            // –ù–∞–ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ totalQuestions = 34, —Ç–æ –∏–Ω–¥–µ–∫—Å—ã 0-33, –ø–æ—Å–ª–µ–¥–Ω–∏–π = 33
            
            console.log('=== TIMEOUT TRIGGERED ===');
            console.log('questionIndex:', questionIndex);
            console.log('totalQuestions:', totalQuestions);
            console.log('Last question index would be:', totalQuestions - 1);
            
            const isLastQuestion = (questionIndex === totalQuestions - 1);
            
            console.log('Is last question?', isLastQuestion);
            
            if (isLastQuestion) {
                // –≠—Ç–æ –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å - –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ—Å—Ç
                console.log('>>> LAST QUESTION - FINISHING QUIZ <<<');
                finishQuiz();
            } else {
                // –ï—Å—Ç—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
                console.log('>>> MOVING TO NEXT QUESTION <<<');
                nextQuestion(questionIndex);
            }
        }, 800); // –ó–∞–¥–µ—Ä–∂–∫–∞ 800–º—Å, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª —Å–≤–æ–π –≤—ã–±–æ—Ä
    }

    function nextQuestion(currentIndex) {
        // –í—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–µ–∫—Å —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
        const nextIndex = currentIndex + 1;
        
        console.log('=== nextQuestion called ===');
        console.log('currentIndex:', currentIndex);
        console.log('nextIndex:', nextIndex);
        console.log('totalQuestions:', totalQuestions);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã
        if (nextIndex >= totalQuestions) {
            // –≠—Ç–æ –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å - –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ—Å—Ç
            console.log('ERROR: nextIndex >= totalQuestions, finishing quiz');
            finishQuiz();
            return;
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
        const currentGroupId = 'question-group-' + currentIndex;
        const currentGroup = document.getElementById(currentGroupId);
        if (currentGroup) {
            currentGroup.style.display = 'none';
            console.log('‚úì Hiding question group:', currentGroupId);
        } else {
            console.error('‚úó Current question group not found:', currentGroupId);
            console.error('Available groups:', Array.from(document.querySelectorAll('.question-group')).map(g => g.id));
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
        currentQuestion = nextIndex;
        const nextGroupId = 'question-group-' + nextIndex;
        const nextGroup = document.getElementById(nextGroupId);
        
        if (nextGroup) {
            nextGroup.style.display = 'block';
            console.log('‚úì Showing question group:', nextGroupId);
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º –≤–æ–ø—Ä–æ—Å–µ
            const nextOptions = nextGroup.querySelectorAll('.option-btn');
            nextOptions.forEach(opt => {
                opt.disabled = false;
                opt.classList.remove('selected');
            });
            console.log('‚úì Unlocked', nextOptions.length, 'buttons for question', nextIndex);
        } else {
            console.error('‚úó Next question group not found:', nextGroupId);
            console.error('Available groups:', Array.from(document.querySelectorAll('.question-group')).map(g => g.id));
            // –ï—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ—Å—Ç
            finishQuiz();
            return;
        }
        
        updateProgress();
        console.log('=== nextQuestion completed ===');
    }

    function finishQuiz() {
        console.log('=== finishQuiz CALLED ===');
        console.trace('Stack trace:');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–≤–∏–∑
        const quizBox = document.getElementById('quiz-box');
        if (quizBox) {
            quizBox.style.display = 'none';
            console.log('‚úì Quiz box hidden');
        } else {
            console.error('‚úó Quiz box not found!');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        showResults();
    }

    function showResults() {
        // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
        const quizHeader = document.querySelector('.quiz-header');
        if (quizHeader) {
            quizHeader.style.display = 'none';
        }
        
        document.getElementById('result').classList.remove('hidden');
        
        let score = 0;
        const reviewContainer = document.getElementById('review-container');
        reviewContainer.innerHTML = '<h3 style="margin-bottom: 20px; color: #333;">üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤:</h3>';

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å
        for (let i = 0; i < totalQuestions; i++) {
            const questionGroup = document.getElementById('question-group-' + i);
            if (!questionGroup) {
                console.error('Question group not found for index:', i);
                continue;
            }
            
            const correctAnswer = questionGroup.dataset.correct || questionGroup.getAttribute('data-correct');
            const questionText = questionGroup.dataset.question || questionGroup.getAttribute('data-question');
            const userAnswer = userAnswers[i] || null;

            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (—É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã)
            const normalizedUserAnswer = userAnswer ? userAnswer.trim() : null;
            const normalizedCorrectAnswer = correctAnswer ? correctAnswer.trim() : '';

            const isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
            if (isCorrect) {
                score++;
            }

            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const reviewItem = document.createElement('div');
            reviewItem.className = 'review-item ' + (isCorrect ? 'correct-answer' : 'wrong-answer');
            
            const reviewQuestion = document.createElement('div');
            reviewQuestion.className = 'review-question';
            reviewQuestion.innerHTML = `${i + 1}. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ: <span class="review-word">${questionText}</span>`;
            
            const reviewAnswers = document.createElement('div');
            reviewAnswers.className = 'review-answers';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (userAnswer) {
                const userAnswerDiv = document.createElement('div');
                userAnswerDiv.className = 'review-answer user-answer';
                userAnswerDiv.innerHTML = `–í–∞—à –æ—Ç–≤–µ—Ç: ${userAnswer}`;
                reviewAnswers.appendChild(userAnswerDiv);
            } else {
                const noAnswerDiv = document.createElement('div');
                noAnswerDiv.className = 'review-answer user-answer';
                noAnswerDiv.innerHTML = '–í—ã –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å';
                reviewAnswers.appendChild(noAnswerDiv);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            const correctAnswerDiv = document.createElement('div');
            correctAnswerDiv.className = 'review-answer correct-answer';
            correctAnswerDiv.innerHTML = `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswer}`;
            reviewAnswers.appendChild(correctAnswerDiv);

            reviewItem.appendChild(reviewQuestion);
            reviewItem.appendChild(reviewAnswers);
            reviewContainer.appendChild(reviewItem);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        const percentage = Math.round((score / totalQuestions) * 100);
        document.getElementById('score-text').textContent = `${score} / ${totalQuestions}`;
        document.getElementById('score-percentage').textContent = `${percentage}% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤`;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const resultIcon = document.getElementById('result-icon');
        const resultMessage = document.getElementById('result-message');
        
        if (percentage === 100) {
            resultIcon.textContent = 'üèÜ';
            resultMessage.textContent = '–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! –í—ã –∑–Ω–∞–µ—Ç–µ –≤—Å–µ —Å–ª–æ–≤–∞ –Ω–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ!';
            resultMessage.style.background = 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';
            resultMessage.style.color = 'white';
        } else if (percentage >= 80) {
            resultIcon.textContent = '‚≠ê';
            resultMessage.textContent = '–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–µ—Ç–µ —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å!';
            resultMessage.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';
            resultMessage.style.color = 'white';
        } else if (percentage >= 60) {
            resultIcon.textContent = 'üëç';
            resultMessage.textContent = '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è!';
            resultMessage.style.background = 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';
            resultMessage.style.color = 'white';
        } else {
            resultIcon.textContent = 'üìö';
            resultMessage.textContent = '–ù–µ–ø–ª–æ—Ö–æ! –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!';
            resultMessage.style.background = '#f8f9fa';
            resultMessage.style.color = '#666';
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        updateProgress();
        
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –∞–∫—Ç–∏–≤–µ–Ω –∏ –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
        const firstGroup = document.getElementById('group-0');
        if (firstGroup) {
            const firstOptions = firstGroup.querySelectorAll('.option-btn');
            firstOptions.forEach(opt => {
                opt.disabled = false;
            });
        }
    });
    </script>
{% endblock %}
